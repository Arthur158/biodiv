<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Species Form</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            background-color: #f4f4f4;
            background-image: url("{{ url_for('static', filename='images/8.png') }}");
            display: flex;
            flex-direction: column;
            justify-content: space-around; /* Distribute items evenly */
            align-items: center;
        }

        h1, h2 {
            margin-bottom: 10px;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 50%;
            padding: 50px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        form label {
            margin-bottom: 5px;
        }

        .results {
            width: 50%;
            overflow-y: auto;  /* Make it scrollable */
            padding: 50px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }



        th, td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        #back {
            display: inline-block;
            text-decoration: none;
            background-color: #3498db;
            color: #ffffff;
            padding: 10px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        a:hover {
            background-color: #2980b9;
        }
        #slider-container {
            text-align: center;
        }

        #slider-container span,
        #slider-container input {
            display: inline-block;
        }

        #slider {
            margin: 0 10px;
        }
        #button-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;

            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #f1f1f1;
        }

        #form {
            width : 100%
        }

        #name {
            width: 240%
        }

        #randomizeName {
            width: 20%
        }

        .name-container {
            display: flex;
            width: 50%;
        }
        
        .main-container {
            display: flex;
            margin: 20px; /* or any value you prefer */
            width:80%;
            height: 60%;
        }

        .bar-button {
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
        }

        button:disabled {
            background-color: grey;
            cursor: not-allowed;
        }

        .field-group {
            display: none;
        }

        /* Style for the main container */
        .flex-container {
            display: flex; 
            gap:30px;
        }

        /* Set a max-width for the slider-container to prevent it from expanding too much */
        #slider-container {
            flex: 1; /* Allows this element to grow */
            padding-right: 20px; /* A bit of spacing between sliders and tables */
            max-width: 50%;  /* You can adjust this value */
        }

        /* Adjust width for both tables */
        #heterotrophic-values, #autotrophic-values {
            flex: 1; /* Allows these elements to grow */
        }

        /* Style for cells in the tbody */
        #heterotrophic-values tbody td, #autotrophic-values tbody td {
            width: 60px;  /* Splits the width equally between attribute and value columns */
            text-align: left;
        }
    </style>
 
    
</head>
<body>
    <div id="button-bar">
        <button class="bar-button" id="save-btn">Save</button>
        {% if status == "closed" %}
            <button class="bar-button" id="play-pause-btn" disabled>Play</button>
        {% elif status == "paused" %}
            <button class="bar-button" id="play-pause-btn">Play</button>
        {% else %}
            <button class="bar-button" id="play-pause-btn">Pause</button>
        {% endif %}
        <button class="bar-button" id="year-btn" style="cursor: not-allowed">Year: {{year}}</button>
        {% if status == "closed" %}
            <button class="bar-button" id="skip-btn" disabled>Skip</button>
        {% elif status == "paused" %}
            <button class="bar-button" id="skip-btn">Skip</button>
        {% else %}
            <button class="bar-button" id="skip-btn" disabled>Skip</button>
        {% endif %}
        <button class="bar-button" id="back-btn">Back</button>
        <button class="bar-button" id="menu-btn">Menu</button>
    </div>
    <h1>Add a species</h1>
      <div class="main-container">
        <form action="/add_species" id="form" method="post">
            <div class="flex-container">
                <div class="name-container">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required>
                    <button type="button" id="randomizeName">Randomize Name</button>
                </div>
                <div class="name-container">
                    <label for="trophic_type">Trophic Type:</label>
                    <select id="trophic_type" name="trophic_type">
                        <option value="heterotrophic">Heterotrophic</option>
                        <option value="autotrophic">Autotrophic</option>
                    </select>
                </div>
            </div>
        
            <div class="flex-container">
                <table id="slider-container-table">
                    <thead>
                        <th>Option</th>
                        <th>Slider</th>
                        <th>Value</th>
                    </thead>
                    <tbody id="slider-container">

                    </tbody>
                </table>
                
                <table id="heterotrophic-values" style="display: none;">
                    <thead>
                        <tr>
                            <th>Attribute</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Values for heterotrophic species will be populated here -->
                    </tbody>
                </table>
                
                <table id="autotrophic-values" style="display: none;">
                    <thead>
                        <tr>
                            <th>Attribute</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Values for autotrophic species will be populated here -->
                    </tbody>
                </table>
            </div>
        
            <input type="submit" value="Submit">
        </form>
        <div class="results">  
            <h2>Species:</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Trophic Type</th>
                        <th>Heterotroph Level</th>
                        <th>Role</th>
                    </tr>
                </thead>
                <tbody>
                    {% for specie in species %}
                    <tr>
                        <td><a href="/species/{{specie[0]}}">{{ specie[0] }}</a></td>
                        <td>{{ specie[1] }}</td>
                        <td>
                            {% if specie[2] is not none %}
                            <span style="color: green;">{{ specie[2] }}</span> / <span style="color: red;">{{ 100 - specie[2] }}</span>
                            {% else %}
                            N/A
                            {% endif %}
                        </td>
                        <td>
                            {% if specie[1] == "autotrophic"%}
                            <span style="color: lightgreen;"> autotrophic</span> 

                            {% elif specie[2] > 75 %}
                            <span style="color: green;"> herbivore</span> 

                            {% elif specie[2] < 25 %}
                            <span style="color: red;"> carnivore</span> 

                            {% else %}
                            <span style="color: orange;"> omnivore</span> 
                            {% endif %}
                            </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $("#randomizeName").click(function() {
                $.ajax({
                    url: "/randomize_name",
                    type: "GET",
                    success: function(randomName) {
                        $("#name").val(randomName);
                    }
                });
            });
            $("#save-btn").click(function() {
                $.ajax({
                    url: "/save",
                    type: "GET",
                });
            });
            $("#skip-btn").click(function() {
                $.ajax({
                    url: "/skip",
                    type: "GET",
                    success: function(response) {
                        location.reload();
                    }
                });
            });
        });
        document.addEventListener("DOMContentLoaded", function() {
            const trophicTypeSelect = document.getElementById('trophic_type');
            const sliderContainer = document.getElementById('slider-container');
            
            const heterotrophicSliders = ['heterotroph_level', 'armor', 'strength', 'speed', 'digestive_strength', 'size'];
            const autotrophicSliders = ['toxicity', 'height', 'size_of_leaves', 'depth_of_roots'];

            const heterotrophicValues = ['evasion', 'anti-evasion', 'attack', 'defense', 'reach', ' ', 'provided_meat', 'calorie_cost'];
            const autotrophicValues = ['Toxicity','unreachability', 'light_absorption', 'water_absorption',' ', 'provided_grass', 'calories_cost'];

            function updateValuesAutotroph() {
                let toxicity = document.getElementById('toxicity').value                
                let height = document.getElementById('height').value
                let size_of_leaves = document.getElementById('size_of_leaves').value
                let depth_of_roots = document.getElementById('depth_of_roots').value


                // Make the AJAX call using fetch API
                fetch('/calculate_stats_autotroph', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ toxicity: toxicity, height: height, size_of_leaves: size_of_leaves, depth_of_roots: depth_of_roots })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('Toxicity').textContent = data.toxicity;
                    document.getElementById('unreachability').textContent = data.unreachability;
                    document.getElementById('light_absorption').textContent = data.light_absorption;
                    document.getElementById('water_absorption').textContent = data.water_absorption;
                    document.getElementById('provided_grass').textContent = data.provided_grass;
                    document.getElementById('calories_cost').textContent = data.calories_cost;
                })
                .catch((error) => {
                console.error('Error:', error);
                });
            }

            function updateValuesHeterotroph() {
                let armor = document.getElementById('armor').value                
                let speed = document.getElementById('speed').value
                let strength = document.getElementById('strength').value
                let digestive_strength = document.getElementById('digestive_strength').value
                let size = document.getElementById('size').value


                // Make the AJAX call using fetch API
                fetch('/calculate_stats_heterotroph', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ armor: armor, speed: speed, strength: strength, digestive_strength: digestive_strength, size: size })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('evasion').textContent = data.evasion;
                    document.getElementById('anti-evasion').textContent = data.anti_evasion;
                    document.getElementById('attack').textContent = data.attack;
                    document.getElementById('defense').textContent = data.defense;
                    document.getElementById('provided_meat').textContent = data.provided_meat;
                    document.getElementById('calorie_cost').textContent = data.calories_cost;
                    document.getElementById('reach').textContent = data.reach;
                })
                .catch((error) => {
                console.error('Error:', error);
                });
            }

            
            function createSliderRow(name) {
                const row = document.createElement('tr');
                
                // Create the label cell
                const labelCell = document.createElement('td');
                labelCell.textContent = name.replace('_', ' ');
                row.appendChild(labelCell);
                
                // Create the slider cell
                const sliderCell = document.createElement('td');
                const slider = document.createElement('input');
                slider.type = 'range';
                slider.id = name;
                slider.name = name;
                slider.min = 0;
                slider.max = 100;


                if(heterotrophicSliders.includes(name)){
                    slider.addEventListener("input", function(event) {
                        updateValuesHeterotroph()
                    })
                } else {
                    slider.addEventListener("input", function(event){
                        updateValuesAutotroph()
                    })
                }

                sliderCell.appendChild(slider);
                row.appendChild(sliderCell);
                
                // Create the value cell
                const valueCell = document.createElement('td');
                const valueBox = document.createElement('span');  // Changed from 'div' to 'span' for inline display
                valueBox.id = `${name}-value`;  // Changed the id format for consistency
                valueBox.textContent = slider.value;
                valueCell.appendChild(valueBox);
                row.appendChild(valueCell);
                
                // Update value box when slider changes
                slider.addEventListener('input', function() {
                    valueBox.textContent = slider.value;
                    
                    // Here you can also add the AJAX call to update server-side values if necessary
                });
                
                return row;
            }

            function populateValuesTable(valuesArray, tableID) {
                const table = document.getElementById(tableID);
                const tbody = table.querySelector('tbody');
                
                // Clear existing values
                tbody.innerHTML = '';
                
                for (const valueName of valuesArray) {
                    const row = document.createElement('tr');
                    
                    const labelCell = document.createElement('td');
                    labelCell.textContent = valueName.replace('_', ' ');
                    row.appendChild(labelCell);

                    const valueCell = document.createElement('td');
                    valueCell.textContent = '...'; // Placeholder value until AJAX updates it
                    valueCell.id = valueName; // ID for easy update
                    row.appendChild(valueCell);
                    
                    tbody.appendChild(row);
                }
            }

            
            function populateSliders(sliderNames, trophic_type) {
                
                const table = document.getElementById("slider-container-table")

                const tbody = table.querySelector('tbody');
                
                // Clear existing values
                tbody.innerHTML = '';
                
                // Add sliders
                for (const name of sliderNames) {
                    const row = createSliderRow(name);
                    tbody.appendChild(row);
                }

                if (sliderNames === heterotrophicSliders) {
                    populateValuesTable(heterotrophicValues, 'heterotrophic-values');
                    document.getElementById('autotrophic-values').style.display = 'none';
                    document.getElementById('heterotrophic-values').style.display = '';
                } else {
                    populateValuesTable(autotrophicValues, 'autotrophic-values');
                    document.getElementById('heterotrophic-values').style.display = 'none';
                    document.getElementById('autotrophic-values').style.display = '';
                }
            }
            
            // Populate sliders based on initial trophic type
            populateSliders(trophicTypeSelect.value === 'heterotrophic' ? heterotrophicSliders : autotrophicSliders);
            
            // Change sliders when trophic type changes
            trophicTypeSelect.addEventListener('change', function() {
                populateSliders(this.value === 'heterotrophic' ? heterotrophicSliders : autotrophicSliders);
            });

            // Add logic here to update calculated values when sliders change
        });
        const playPauseBtn = document.getElementById('play-pause-btn');
        const skipBtn = document.getElementById('skip-btn');
    
        playPauseBtn.addEventListener('click', function() {
        if (playPauseBtn.textContent === 'Play') {
            playPauseBtn.textContent = 'Pause';
            skipBtn.disabled = true;
        } else {
            playPauseBtn.textContent = 'Play';
            skipBtn.disabled = false;
        }
        });
        document.getElementById("back-btn").addEventListener("click", function() {
            window.history.back();
        });
        document.getElementById("menu-btn").addEventListener("click", function() {
            window.location.href = "/";  // Replace with the local path you want to navigate to
        });
    </script>
</body>
</html>
